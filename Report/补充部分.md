## 四. 实时辐射监测与预测的可视化系统

- **系统架构**：Raspberry Pi5 负责 8 通道热电芯片电压采集（10 s/次），通过 Python 脚本调用 ADS1115 驱动库读取数据并写入 CSV；数据发送模块利用 `requests` 库读取最新记录并通过 HTTP POST `/data` 推送到主机端。PC 侧后端服务基于 `Flask` 框架构建，提供接收与状态查询接口，维护 60 点滑动窗口，数据就绪后调用推理引擎，结果与原始数据同步写入 CSV 文件。可视化应用程序内嵌 HTTP 服务，定期读取数据并绘制。
- **通信与数据流**：POST 端点 `/data` 接收 JSON 格式的时间戳与电压数据；GET 端点覆盖健康检查、窗口数据、最近预测等功能。系统设置冷却时间防止高频推理；接收与可视化解耦为独立线程与 CSV 落盘，保证数据不丢。
- **模型与推理**：推理引擎模块基于 `PyTorch` 封装 LSTM/GRU 模型，默认使用 CPU 进行推理，自动加载标准化器（Scaler），支持 1 步与多步（常用 10 步）预测；提供模拟推理模式便于无模型测试。输入要求为固定长度的时间序列，输出结果支持通道名称映射与多步结果访问。
- **可视化界面**：采用 `PyQt5` 构建主界面，结合 `Matplotlib` 实现双面板布局。左侧为控制面板（系统状态、通道选择、预测步数、当前值、刷新/清空），右侧展示 8 通道子图或单通道大图；历史数据绘制为实线，预测结果为橙色虚线圆点；状态指示灯实时显示“等待数据/数据就绪/推理中/推理完成”。
- **可靠性优化**：限制底层线性代数库线程数、防止多线程死锁；引入推理冷却机制与线程锁避免重复推理；将 `Matplotlib` 图表中的文本元素英文化以避免中文字体渲染阻塞；使用文件锁保证 CSV 写入安全；边缘端实现 HTTP 超时自动重试机制。
- **测试验证**：提供完整的模拟与真实链路验证方案：先启动可视化界面，再通过模拟发送脚本或真实采集发送流程，检查连续 HTTP 200 响应与无超时状态，确保单步/十步预测均能长时间稳定运行；支持通过系统服务（Systemd）持续运行采集与发送任务。

## 五. 天空图像处理系统

- **目标与算法**：基于 `OpenCV` 与 `Tkinter` 开发的天空图像快速评估与标注工具，核心算法计算云概率图（红蓝比 + 亮度加权并高斯平滑），生成像素级概率/亮度/纹理/边缘等多通道特征；提取图像级指标：云覆盖率、亮度起伏、纹理方差、边缘密度、天空均匀度、有效像素数。
- **界面与视图**：采用 `Tkinter` 实现双视图布局，左侧显示原图，右侧可切换多种视图（概率叠加、概率热图、原图、灰度、边缘、拉普拉斯纹理、单帧柱状图、文件夹趋势曲线）。概率视图自动显示色标；新图自动自适应缩放并保留每图最小缩放上限；支持鼠标滚轮平滑缩放。
- **探针与度量**：严格分离图像视图与图表视图的交互逻辑。图像视图点击记录探针坐标、云概率与所选像素指标，在右图打标记并记录到表格与日志；图表视图点击仅记录当前图像级指标值。探针表格支持数据复制、清空与 CSV 导出。
- **数据管理**：支持按日期文件夹扫描批量图片；可从 CSV 索引文件读取预计算指标并用路径或文件名匹配，缺失时实时计算；时间戳可由文件路径解析。界面提供 Summary/Probes/Log 选项卡，内置指标含义说明始终保留，便于复核。
- **呈现与易用性**：色标仅在概率视图显示以放大右图空间；避免在图上绘制文字减轻遮挡；柱状图与趋势图使用 `Matplotlib` 的 Agg 后端进行离屏渲染，防止阻塞界面；默认使用英文字体以确保多语言环境下的兼容性，支持中文路径读图。

## 结论

本阶段完成了“实时辐射监测与预测的可视化系统”与“天空图像处理系统”的功能实现与稳定性加固：前者打通了采集-传输-推理-可视化全链路，提供可靠的滑动窗口管理、1/10 步预测与专业 GUI；后者构建了可复用的天空图像分析工具链，集成概率热图、像素/图像级指标与批量管理、标注导出能力。两部分共同为多波段天空辐射观测提供了实时监测与后处理分析手段，下一步可在统一数据接口上联动两系统、引入更多模型与自动化标注以提升预测精度与场景适应性。
